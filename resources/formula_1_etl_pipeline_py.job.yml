resources:
  jobs:
    formula_1_etl_pipeline_py:
      name: formula_1_etl_pipeline_py
      tasks:
        # Bronze Layer Tasks
        - task_key: 01_bronze_circuits
          spark_python_task:
            python_file: ../formula_1_etl/scripts/01_bronze/01_bronze_circuits.py
            parameters:
              - "{{job.id}}"
              - "{{job.run_id}}"
              - "{{task.run_id}}"
              - "{{job.start_time.iso_datetime}}"
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 01_bronze_races
          spark_python_task:
            python_file: ../formula_1_etl/scripts/01_bronze/02_bronze_races.py
            parameters:
              - "{{job.id}}"
              - "{{job.run_id}}"
              - "{{task.run_id}}"
              - "{{job.start_time.iso_datetime}}"
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 01_bronze_constructors
          spark_python_task:
            python_file: ../formula_1_etl/scripts/01_bronze/03_bronze_constructors.py
            parameters:
              - "{{job.id}}"
              - "{{job.run_id}}"
              - "{{task.run_id}}"
              - "{{job.start_time.iso_datetime}}"
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 01_bronze_drivers
          spark_python_task:
            python_file: ../formula_1_etl/scripts/01_bronze/04_bronze_drivers.py
            parameters:
              - "{{job.id}}"
              - "{{job.run_id}}"
              - "{{task.run_id}}"
              - "{{job.start_time.iso_datetime}}"
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 01_bronze_results
          spark_python_task:
            python_file: ../formula_1_etl/scripts/01_bronze/05_bronze_results.py
            parameters:
              - "{{job.id}}"
              - "{{job.run_id}}"
              - "{{task.run_id}}"
              - "{{job.start_time.iso_datetime}}"
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 01_bronze_pit_stops
          spark_python_task:
            python_file: ../formula_1_etl/scripts/01_bronze/06_bronze_pit_stops.py
            parameters:
              - "{{job.id}}"
              - "{{job.run_id}}"
              - "{{task.run_id}}"
              - "{{job.start_time.iso_datetime}}"
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 01_bronze_lap_times
          spark_python_task:
            python_file: ../formula_1_etl/scripts/01_bronze/07_bronze_lap_times.py
            parameters:
              - "{{job.id}}"
              - "{{job.run_id}}"
              - "{{task.run_id}}"
              - "{{job.start_time.iso_datetime}}"
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 01_bronze_qualifying
          spark_python_task:
            python_file: ../formula_1_etl/scripts/01_bronze/08_bronze_qualifying.py
            parameters:
              - "{{job.id}}"
              - "{{job.run_id}}"
              - "{{task.run_id}}"
              - "{{job.start_time.iso_datetime}}"
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        # Silver Layer Tasks
        - task_key: 02_silver_circuits
          depends_on:
            - task_key: 01_bronze_circuits
          spark_python_task:
            python_file: ../formula_1_etl/scripts/02_silver/01_silver_circuits.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 02_silver_races
          depends_on:
            - task_key: 01_bronze_races
          spark_python_task:
            python_file: ../formula_1_etl/scripts/02_silver/02_silver_races.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 02_silver_constructors
          depends_on:
            - task_key: 01_bronze_constructors
          spark_python_task:
            python_file: ../formula_1_etl/scripts/02_silver/03_silver_constructors.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 02_silver_drivers
          depends_on:
            - task_key: 01_bronze_drivers
          spark_python_task:
            python_file: ../formula_1_etl/scripts/02_silver/04_silver_drivers.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 02_silver_results
          depends_on:
            - task_key: 01_bronze_results
          spark_python_task:
            python_file: ../formula_1_etl/scripts/02_silver/05_silver_results.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 02_silver_pit_stops
          depends_on:
            - task_key: 01_bronze_pit_stops
          spark_python_task:
            python_file: ../formula_1_etl/scripts/02_silver/06_silver_pit_stops.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 02_silver_lap_times
          depends_on:
            - task_key: 01_bronze_lap_times
          spark_python_task:
            python_file: ../formula_1_etl/scripts/02_silver/07_silver_lap_times.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 02_silver_qualifying
          depends_on:
            - task_key: 01_bronze_qualifying
          spark_python_task:
            python_file: ../formula_1_etl/scripts/02_silver/08_silver_qualifying.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        # Gold Layer Tasks
        - task_key: 03_gold_race_results
          depends_on:
            - task_key: 02_silver_circuits
            - task_key: 02_silver_races
            - task_key: 02_silver_constructors
            - task_key: 02_silver_drivers
            - task_key: 02_silver_results
          spark_python_task:
            python_file: ../formula_1_etl/scripts/03_gold/01_gold_race_results.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 03_gold_driver_standings
          depends_on:
            - task_key: 03_gold_race_results
          spark_python_task:
            python_file: ../formula_1_etl/scripts/03_gold/02_gold_driver_standings.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
        - task_key: 03_gold_constructor_standings
          depends_on:
            - task_key: 03_gold_race_results
          spark_python_task:
            python_file: ../formula_1_etl/scripts/03_gold/03_gold_constructor_standings.py
            parameters:
              - "${var.catalog}"
          libraries:
            - whl: ../dist/*.whl
          job_cluster_key: standard_d4s_v3_cluster_id
      job_clusters:
        - job_cluster_key: standard_d4s_v3_cluster_id
          new_cluster: "${var.standard_d4s_v3_cluster_id}"
      queue:
        enabled: true
